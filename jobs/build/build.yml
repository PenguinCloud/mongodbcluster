---
- name: Install required packages
  apt:
    name: 
      - software-properties-common
      - gnupg
      - apt-transport-https
      - ca-certificates
    state: present
    update_cache: true

- name: Fetch the MongoDB public GPG key
  get_url:
    url: https://www.mongodb.org/static/pgp/server-6.0.asc
    dest: "/opt/mongodb.gpg"

- name: Add the MongoDB public GPG key to the system
  command: gpg --no-default-keyring --keyring /usr/share/keyrings/mongodb-server-6.0.gpg --import /opt/mongodb.gpg

- name: Remove temporary MongoDB public GPG key file
  file:
    path: "/opt/mongodb.gpg"
    state: absent

- name: Add the MongoDB repository
  ansible.builtin.lineinfile:
    path: /etc/apt/sources.list.d/mongodb-org-6.0.list
    line: 'deb [ arch=amd64,arm64 signed-by=/usr/share/keyrings/mongodb-server-6.0.gpg ] https://repo.mongodb.org/apt/ubuntu jammy/mongodb-org/6.0 multiverse'
    create: yes

- name: Update the package database
  ansible.builtin.apt:
    update_cache: yes

- name: Install MongoDB
  ansible.builtin.apt:
    name: mongodb-org
    state: present
    update_cache: yes