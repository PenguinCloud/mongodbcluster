---
- name: Check replica set status using shell
  shell:
    cmd:  >
      mongosh mongodb1:27017 -u someone -p p@ssword
      --eval "rs.status()"
  register: rs_status_output
  when: primary_cluster == "1"

- name: Display rs.status() output
  debug:
    var: rs_status_output.stdout_lines
  when: primary_cluster == "1"

- name: Check MongoDB process
  shell: ps -ef | grep mongod | grep -v grep
  register: mongod_process
  changed_when: false
  retries: 5
  delay: 10
  until: mongod_process.rc == 0
  ignore_errors: true

- name: Display MongoDB status
  debug:
    msg: "MongoDB is {{ 'running' if mongod_process.stdout else 'not running' }}"
 


